#!/bin/bash

working_directory=$(pwd)
output_file="/arcade/wboy/wbcfg"

# XOR Table
xor_table=(
    0x04 0x54 0x51 0x15 0x40 0x44 0x01 0x51
    0x55 0x10 0x44 0x41 0x05 0x55 0x50 0x14
    0x41 0x45 0x00 0x50 0x54 0x11 0x45 0x40
    0x04 0x54 0x51 0x15 0x40 0x44 0x01 0x51
    0x55 0x10 0x44 0x41 0x05 0x55 0x50 0x14
    0x41 0x45 0x00 0x50 0x54 0x11 0x45 0x40
    0x04 0x54 0x51 0x15 0x40 0x44 0x01 0x51
    0x55 0x10 0x44 0x41 0x05 0x55 0x50 0x14
    0x04 0x54 0x51 0x15 0x40 0x44 0x01 0x51
    0x55 0x10 0x44 0x41 0x05 0x55 0x50 0x14
    0x41 0x45 0x00 0x50 0x54 0x11 0x45 0x40
    0x04 0x54 0x51 0x15 0x40 0x44 0x01 0x51
    0x55 0x10 0x44 0x41 0x05 0x55 0x50 0x14
    0x41 0x45 0x00 0x50 0x54 0x11 0x45 0x40
    0x04 0x54 0x51 0x15 0x40 0x44 0x01 0x51
    0x55 0x10 0x44 0x41 0x05 0x55 0x50 0x14
)

# Swap Table
swp_table=(
    0x00 0x00 0x00 0x00 0x01 0x01 0x01 0x01 0x01 0x02
    0x02 0x02 0x02 0x02 0x03 0x03 0x03 0x03 0x04 0x04
    0x04 0x04 0x04 0x05 0x05 0x05 0x05 0x05 0x06 0x06
    0x06 0x06 0x06 0x07 0x07 0x07 0x07 0x07 0x08 0x08
    0x08 0x08 0x09 0x09 0x09 0x09 0x09 0x0A 0x0A 0x0A
    0x0A 0x0A 0x0B 0x0B 0x0B 0x0B 0x0B 0x0C 0x0C 0x0C
    0x0C 0x0C 0x0D 0x0D 0x08 0x08 0x08 0x08 0x09 0x09
    0x09 0x09 0x09 0x0A 0x0A 0x0A 0x0A 0x0A 0x0B 0x0B
    0x0B 0x0B 0x0C 0x0C 0x0C 0x0C 0x0C 0x0D 0x0D 0x0D
    0x0D 0x0D 0x0E 0x0E 0x0E 0x0E 0x0E 0x0F 0x0F 0x0F
    0x0F 0x0F 0x10 0x10 0x10 0x10 0x11 0x11 0x11 0x11
    0x11 0x12 0x12 0x12 0x12 0x12 0x13 0x13 0x13 0x13
    0x13 0x14 0x14 0x14 0x14 0x14 0x15 0x15
)

# Creating directories
mkdir -p "$working_directory/arcade/wboy"

# Building CPU ROM
cat epr-7489.116 epr-7490.109 > "$working_directory/arcade/wboy/rom1.bin"

# Copying non-encrypted data
cp epr-7491.96 "$working_directory/arcade/wboy/"

# Copying sound ROMs
cp epr-7498.120 "$working_directory/arcade/wboy/"

# Copying tile ROMs
cp epr-7497.62 "$working_directory/arcade/wboy/"
cp epr-7495.64 "$working_directory/arcade/wboy/"
cp epr-7493.66 "$working_directory/arcade/wboy/"
cp epr-7496.61 "$working_directory/arcade/wboy/"
cp epr-7494.63 "$working_directory/arcade/wboy/"
cp epr-7492.65 "$working_directory/arcade/wboy/"

# Combining sprite ROMs
cat epr-7485.117 epr-7487.04 epr-7486.110 epr-7488.05 > "$working_directory/arcade/wboy/sprites.bin"

# Copying lookup PROM
cp pr-5317.76 "$working_directory/arcade/wboy/"

# Dumping XOR table
echo -ne "$(printf '\\x%02x' "${xor_table[@]}")" > "$working_directory/arcade/wboy/xortable.bin"

# Dumping swap table
echo -ne "$(printf '\\x%02x' "${swp_table[@]}")" > "$working_directory/arcade/wboy/swptable.bin"


echo "Generate config file"
dd if=/dev/zero bs=1 count=73 | tr "\000" "\377" > "$working_directory/arcade/wboy/wbcfg"


echo "All Done!"